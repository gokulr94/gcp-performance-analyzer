<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GCP Performance Calculator for Support Engineers</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>GCP Performance Bottleneck Calculator</h1>
            <p class="subtitle">Calculate actual performance limits based on machine type, disk type, and disk size</p>
            <p class="use-case">For GCP Support Engineers troubleshooting customer performance issues</p>
        </header>

        <main>
            <div class="calculator-section">
                <h2>Configuration Input</h2>
                <div class="input-grid">
                    <div class="input-group">
                        <label for="machineSelect">Machine Type</label>
                        <select id="machineSelect" class="dropdown">
                            <option value="">Loading machines...</option>
                        </select>
                        <p class="input-hint">Select customer's VM machine type</p>
                    </div>

                    <div class="input-group">
                        <label for="diskTypeSelect">Disk Type</label>
                        <select id="diskTypeSelect" class="dropdown">
                            <option value="">Loading disk types...</option>
                        </select>
                        <p class="input-hint">Select persistent disk type attached to the VM</p>
                    </div>

                    <div class="input-group">
                        <label for="diskSizeInput">Disk Size (GB)</label>
                        <input type="number" id="diskSizeInput" class="number-input" min="10" max="65000" value="100">
                        <p class="input-hint" id="diskSizeHint">Enter disk size in GB (min: 10, max: 65,000)</p>
                        <p class="validation-error" id="diskSizeValidation"></p>
                    </div>
                </div>

                <button id="calculateBtn" class="calculate-btn" disabled>Calculate Performance</button>
            </div>

            <div id="resultsSection" class="results-section" style="display: none;">
                <div class="results-header">
                    <h2>Performance Analysis</h2>
                    <div class="config-summary" id="configSummary"></div>
                </div>

                <!-- Over-provisioning Warning -->
                <div id="overProvisionWarning" class="over-provision-warning" style="display: none;"></div>

                <!-- Quick Summary Cards -->
                <div class="quick-summary">
                    <div class="summary-card">
                        <div class="summary-label">Read IOPS</div>
                        <div class="summary-value" id="summaryReadIops">-</div>
                        <div class="summary-bar">
                            <div class="bar-fill" id="barReadIops"></div>
                        </div>
                        <div class="summary-status" id="statusReadIops">-</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-label">Write IOPS</div>
                        <div class="summary-value" id="summaryWriteIops">-</div>
                        <div class="summary-bar">
                            <div class="bar-fill" id="barWriteIops"></div>
                        </div>
                        <div class="summary-status" id="statusWriteIops">-</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-label">Read Throughput</div>
                        <div class="summary-value" id="summaryReadThroughput">-</div>
                        <div class="summary-bar">
                            <div class="bar-fill" id="barReadThroughput"></div>
                        </div>
                        <div class="summary-status" id="statusReadThroughput">-</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-label">Write Throughput</div>
                        <div class="summary-value" id="summaryWriteThroughput">-</div>
                        <div class="summary-bar">
                            <div class="bar-fill" id="barWriteThroughput"></div>
                        </div>
                        <div class="summary-status" id="statusWriteThroughput">-</div>
                    </div>
                </div>

                <!-- Performance Comparison Table -->
                <div class="comparison-section">
                    <h3>Performance Limits Comparison</h3>
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>Machine Limit</th>
                                <th>Disk Performance</th>
                                <th>Effective</th>
                                <th>Utilization</th>
                            </tr>
                        </thead>
                        <tbody id="comparisonTableBody">
                        </tbody>
                    </table>
                </div>

                <!-- Collapsible: Calculation Details -->
                <div class="collapsible-section">
                    <button class="collapsible-toggle" onclick="toggleSection('calcDetails')">
                        <span id="calcDetailsIcon">▶</span> Calculation Details
                    </button>
                    <div id="calcDetails" class="collapsible-content" style="display: none;">
                        <!-- Calculation Breakdown -->
                        <div id="calculationBreakdown" class="calculation-breakdown">
                            <div id="breakdownContent" class="breakdown-content"></div>
                        </div>

                        <!-- Formula Reference -->
                        <div class="formula-content">
                            <h4>Formula Reference</h4>
                            <div class="formula-grid">
                                <div class="formula-item">
                                    <strong>Standard/Balanced/SSD:</strong>
                                    <code>IOPS = min(baseline + size × IOPS/GB, max)</code>
                                </div>
                                <div class="formula-item">
                                    <strong>Effective Performance:</strong>
                                    <code>Effective = min(Machine_Limit, Disk_Perf)</code>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Collapsible: Machine Specs -->
                <div class="collapsible-section">
                    <button class="collapsible-toggle" onclick="toggleSection('machineSpecs')">
                        <span id="machineSpecsIcon">▶</span> Machine Type Specifications
                    </button>
                    <div id="machineSpecs" class="collapsible-content" style="display: none;">
                        <div class="spec-grid">
                            <div class="spec-item">
                                <span class="spec-label">Family:</span>
                                <span class="spec-value" id="machineFamily">-</span>
                            </div>
                            <div class="spec-item">
                                <span class="spec-label">vCPUs:</span>
                                <span class="spec-value" id="machineVcpu">-</span>
                            </div>
                            <div class="spec-item">
                                <span class="spec-label">Memory:</span>
                                <span class="spec-value" id="machineMemory">-</span>
                            </div>
                            <div class="spec-item">
                                <span class="spec-label">Network:</span>
                                <span class="spec-value" id="machineNetwork">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Analysis -->
                <div class="ai-section">
                    <button id="analyzeBtn" class="ai-btn">Get AI Recommendations</button>
                    <div id="aiAnalysis" class="ai-analysis" style="display: none;">
                        <h3>AI-Powered Analysis & Recommendations</h3>
                        <div id="analysisText" class="analysis-content"></div>
                    </div>
                </div>
            </div>

            <div id="loadingIndicator" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>Calculating...</p>
            </div>

            <div id="errorMessage" class="error-message" style="display: none;">
                <div class="error-icon">❌</div>
                <p id="errorText"></p>
            </div>
        </main>

        <footer>
            <p>Performance Calculator for GCP Support Engineers | Data based on official GCP documentation</p>
            <p class="doc-links">
                <a href="https://cloud.google.com/compute/docs/machine-types" target="_blank">Machine Types</a> |
                <a href="https://cloud.google.com/compute/docs/disks/performance" target="_blank">Disk Performance</a> |
                <a href="https://cloud.google.com/compute/docs/disks" target="_blank">Disk Types</a>
            </p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
